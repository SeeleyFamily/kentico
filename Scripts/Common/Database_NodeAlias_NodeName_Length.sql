-- This script ensures that the ClassXmlSchema and ClassFormDefinition are set for 450 for NodeAlias / NodeAliasPath and 100 for NodeName

UPDATE CMS_Class
SET ClassXmlSchema = '<?xml version="1.0" encoding="utf-8"?>  <xs:schema id="NewDataSet" xmlns="" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:msdata="urn:schemas-microsoft-com:xml-msdata">    <xs:element name="NewDataSet" msdata:IsDataSet="true" msdata:UseCurrentLocale="true">      <xs:complexType>        <xs:choice minOccurs="0" maxOccurs="unbounded">          <xs:element name="CMS_Tree">            <xs:complexType>              <xs:sequence>                <xs:element name="NodeID" msdata:ReadOnly="true" msdata:AutoIncrement="true" type="xs:int" />                <xs:element name="NodeAliasPath">                  <xs:simpleType>                    <xs:restriction base="xs:string">                      <xs:maxLength value="450" />                    </xs:restriction>                  </xs:simpleType>                </xs:element>                <xs:element name="NodeName">                  <xs:simpleType>                    <xs:restriction base="xs:string">                      <xs:maxLength value="100" />                    </xs:restriction>                  </xs:simpleType>                </xs:element>                <xs:element name="NodeAlias" minOccurs="0">                  <xs:simpleType>                    <xs:restriction base="xs:string">                      <xs:maxLength value="450" />                    </xs:restriction>                  </xs:simpleType>                </xs:element>                <xs:element name="NodeClassID" type="xs:int" />                <xs:element name="NodeParentID" type="xs:int" minOccurs="0" />                <xs:element name="NodeLevel" type="xs:int" />                <xs:element name="NodeACLID" type="xs:int" minOccurs="0" />                <xs:element name="NodeSiteID" type="xs:int" />                <xs:element name="NodeGUID" msdata:DataType="System.Guid, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" type="xs:string" />                <xs:element name="NodeOrder" type="xs:int" minOccurs="0" />                <xs:element name="IsSecuredNode" type="xs:boolean" minOccurs="0" />                <xs:element name="NodeSKUID" type="xs:int" minOccurs="0" />                <xs:element name="NodeLinkedNodeID" type="xs:int" minOccurs="0" />                <xs:element name="NodeOwner" type="xs:int" minOccurs="0" />                <xs:element name="NodeCustomData" minOccurs="0">                  <xs:simpleType>                    <xs:restriction base="xs:string">                      <xs:maxLength value="2147483647" />                    </xs:restriction>                  </xs:simpleType>                </xs:element>                <xs:element name="NodeLinkedNodeSiteID" type="xs:int" minOccurs="0" />                <xs:element name="NodeHasChildren" type="xs:boolean" minOccurs="0" />                <xs:element name="NodeHasLinks" type="xs:boolean" minOccurs="0" />                <xs:element name="NodeOriginalNodeID" type="xs:int" minOccurs="0" />                <xs:element name="NodeIsACLOwner" type="xs:boolean" />              </xs:sequence>            </xs:complexType>          </xs:element>        </xs:choice>      </xs:complexType>      <xs:unique name="Constraint1" msdata:PrimaryKey="true">        <xs:selector xpath=".//CMS_Tree" />        <xs:field xpath="NodeID" />      </xs:unique>    </xs:element>  </xs:schema>'
WHERE ClassName = 'CMS.Tree';
UPDATE CMS_Class
SET ClassFormDefinition = '<form version="2"><field column="NodeID" columntype="integer" guid="cdd9eb7c-0a26-4e56-8887-df984df6c02c" isPK="true" isunique="true" system="true" visible="true"><properties><fieldcaption>NodeID</fieldcaption></properties><settings><controlname>labelcontrol</controlname></settings></field><field column="NodeAliasPath" columnsize="450" columntype="text" guid="9674087b-5e2e-4ba1-a24c-416aa8c5dfe9" system="true" visible="true"><properties><fieldcaption>NodeAliasPath</fieldcaption></properties><settings><controlname>textboxcontrol</controlname></settings></field><field column="NodeName" columnsize="100" columntype="text" guid="94cc4d43-93e6-471e-b9f9-288f4f8822c6" system="true" visible="true"><properties><fieldcaption>NodeName</fieldcaption></properties><settings><controlname>textboxcontrol</controlname></settings></field><field column="NodeAlias" columnsize="450" columntype="text" guid="7d6e0784-a48c-4dc1-96c3-7ba807a71af6" system="true" visible="true"><properties><fieldcaption>NodeAlias</fieldcaption></properties><settings><controlname>textboxcontrol</controlname></settings></field><field column="NodeClassID" columntype="integer" guid="7905e92a-1e37-485d-b9c5-ceaaaa4bf160" system="true" visible="true"><properties><fieldcaption>NodeClassID</fieldcaption></properties><settings><controlname>textboxcontrol</controlname></settings></field><field allowempty="true" column="NodeParentID" columntype="integer" guid="0268faac-80dc-4329-a644-5b3b09381ec3" system="true" visible="true"><properties><fieldcaption>NodeParentID</fieldcaption></properties><settings><AutoCompleteEnableCaching>False</AutoCompleteEnableCaching><AutoCompleteFirstRowSelected>False</AutoCompleteFirstRowSelected><AutoCompleteShowOnlyCurrentWordInCompletionListItem>False</AutoCompleteShowOnlyCurrentWordInCompletionListItem><controlname>TextBoxControl</controlname><Trim>False</Trim></settings></field><field column="NodeLevel" columntype="integer" guid="1831820a-3173-495d-889b-782c3d53104d" system="true" visible="true"><properties><fieldcaption>NodeLevel</fieldcaption></properties><settings><controlname>textboxcontrol</controlname></settings></field><field allowempty="true" column="NodeACLID" columntype="integer" guid="b5e5e982-82c3-42ef-a7ed-18426274bd99" system="true" visible="true"><properties><fieldcaption>NodeACLID</fieldcaption></properties><settings><controlname>textboxcontrol</controlname></settings></field><field column="NodeIsACLOwner" columntype="boolean" guid="c23cef9a-3b63-4780-bb00-fe534afea05f" system="true"><properties><defaultvalue>False</defaultvalue></properties></field><field column="NodeSiteID" columntype="integer" guid="9689d3d6-7a26-46d5-84d1-539a332ebe65" system="true" visible="true"><properties><fieldcaption>NodeSiteID</fieldcaption></properties><settings><controlname>textboxcontrol</controlname></settings></field><field column="NodeGUID" columntype="guid" guid="40512c1e-c190-421f-942b-48de69e28563" system="true" visible="true"><properties><fieldcaption>NodeGUID</fieldcaption></properties><settings><controlname>labelcontrol</controlname></settings></field><field allowempty="true" column="NodeOrder" columntype="integer" guid="95082034-c311-4d61-9ed9-943e62964fae" system="true" visible="true"><properties><fieldcaption>NodeOrder</fieldcaption></properties><settings><controlname>textboxcontrol</controlname></settings></field><field allowempty="true" column="IsSecuredNode" columntype="boolean" guid="c51e1a5c-09dd-4a1b-b707-9a1bbb428108" system="true" visible="true"><properties><fieldcaption>IsSecuredNode</fieldcaption></properties><settings><controlname>checkboxcontrol</controlname></settings></field><field allowempty="true" column="NodeSKUID" columntype="integer" guid="7225569d-1faa-4b4d-979d-5c78b6c81a5e" system="true" visible="true"><properties><fieldcaption>NodeSKUID</fieldcaption></properties><settings><controlname>textboxcontrol</controlname></settings></field><field allowempty="true" column="NodeHasChildren" columntype="boolean" guid="c4849227-946b-4b1f-8ef3-d659addc26b6" system="true" visible="true"><properties><defaultvalue>false</defaultvalue><fieldcaption>NodeHasChildren</fieldcaption></properties><settings><controlname>checkboxcontrol</controlname></settings></field><field allowempty="true" column="NodeHasLinks" columntype="boolean" guid="fe34377d-e963-4e31-a5a7-14999303edb9" system="true" visible="true"><properties><defaultvalue>false</defaultvalue><fieldcaption>Node has links </fieldcaption></properties><settings><controlname>CheckBoxControl</controlname></settings></field><field allowempty="true" column="NodeLinkedNodeID" columntype="integer" guid="c740f968-4987-459b-b3fb-c746de86cc9b" system="true" visible="true"><properties><fieldcaption>NodeLinkedNodeID</fieldcaption></properties><settings><controlname>textboxcontrol</controlname></settings></field><field allowempty="true" column="NodeOwner" columntype="integer" guid="5a08edce-a779-441c-9228-67361c219a92" system="true" visible="true"><properties><fieldcaption>NodeOwner</fieldcaption></properties><settings><controlname>textboxcontrol</controlname></settings></field><field allowempty="true" column="NodeCustomData" columntype="longtext" guid="618beea2-a4ea-4fbb-a19c-5793df9c8ad5" system="true" visible="true"><properties><fieldcaption>NodeCustomData</fieldcaption></properties><settings><controlname>textareacontrol</controlname></settings></field><field allowempty="true" column="NodeLinkedNodeSiteID" columntype="integer" guid="c07462a8-3278-4f65-9307-0279d5b9211a" system="true" visible="true"><properties><fieldcaption>NodeLinkedNodeSiteID</fieldcaption></properties><settings><controlname>textboxcontrol</controlname></settings></field><field allowempty="true" column="NodeOriginalNodeID" columntype="integer" guid="950ca3d2-dfae-4b4c-8db2-f11582227ae3" system="true" /></form>'
WHERE ClassName = 'CMS.Tree';

UPDATE CMS_Class 
SET ClassFormDefinition = REPLACE(ClassFormDefinition, 'column="NodeAlias" columnsize="50"','column="NodeAlias" columnsize="450"') 
WHERE ClassFormDefinition LIKE '%column="NodeAlias" columnsize="50"%'


-- The bottom code is how you might update the sizes for these values
-- Drop the View
-- Alter the Tables
-- Recreate the View


--DROP VIEW View_CMS_Tree_Joined;

--ALTER TABLE CMS_Tree
--ALTER COLUMN NodeName NVARCHAR(100);

--ALTER TABLE CMS_Tree
--ALTER COLUMN NodeAlias NVARCHAR(450);

--ALTER TABLE CMS_Tree
--ALTER COLUMN NodeAliasPath NVARCHAR(450);

--ALTER TABLE CMS_Document
--ALTER COLUMN DocumentName NVARCHAR(100);

